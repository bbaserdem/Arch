# Maintained by sbp
prestr='sbp-admin'

systemd_services() {
  if [ "${1}" = 'enable' ] ; then     action='enable'  ; prstrn='Enabling'
  elif [ "${1}" = 'disable' ] ; then  action='disable' ; prstrn='Disabling'
  elif [ -z "${1}" ] ; then           action='enable'  ; prstrn='Enabling'
  else
    echo "Invalid action type"
    exit 1
  fi
  echo '['"${prestr}"']==> '${prstrn}' systemd services!'
  # Services
  echo '['"${prestr}"']==> Enabling cron.'
  /usr/bin/systemctl "${action}" fcron.service
  echo '['"${prestr}"']==> Enabling MCE monitoring'
  /usr/bin/systemctl enable rasdaemon.service
  /usr/bin/systemctl enable ras-mc-ctl.service

  echo '['"${prestr}"']==> '"${prstrn}"' systemd services, done!'
}

post_install() {
  echo '['"${prestr}"']==> Installing meta package...'

  # Timezone
  echo '['"${prestr}"']==> Setting local time settings.'
  /usr/bin/timedatectl set-ntp true
  /usr/bin/hwclock --systohc

  # Services
  systemd_services enable


  echo '['"${prestr}"']==> Installation done!'
  post_upgrade
}

post_upgrade() {
  echo '['"${prestr}"']==> Upgrading meta package...'
  echo '['"${prestr}"']==> Upgrade done!'
}

post_remove() {
  echo '['"${prestr}"']==> Uninstalling meta package...'

  # Services
  echo '['"${prestr}"']==> Disabling CPU scaling manager.'
  /usr/bin/systemctl disable cpupower.service

  echo '['"${prestr}"']==> Disbling cron.'
  /usr/bin/systemctl disable fcron.service

  echo '['"${prestr}"']==> Disbling MCE monitoring'
  /usr/bin/systemctl disable rasdaemon.service
  /usr/bin/systemctl disable ras-mc-ctl.service

  echo '['"${prestr}"']==> Unistallation done!'
}
