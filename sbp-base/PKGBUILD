# Maintainer: Batuhan Baserdem <baserdem.batuhan@gmail.com>
# vim: ft=PKGBUILD
pkgname=sbp-base
pkgver=4.0
pkgrel=6
pkgdesc="SBP Meta Package: base system"
arch=('any')
url="https://github.com/bbaserdem/Arch"
licence=(MIT)
validpgpkeys=('0B7151C823559DD8A7A04CE36426139E2F4C6CCE')
source=(
    'base.install'
    'base.root-ssh'
    'admin.etckeeper'
    'admin.install'
    'admin.reflect-service'
    'admin.reflect-timer'
    'admin.repo-build'
    'admin.repo-remove'
    'admin.repo-sync'
    'admin.tzupdate')
sha256sums=(SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP)
package() {
    install=base.install
    provides=('vim')
    conflicts=('vim')
    depends=('base')

    # BASE stuff
    # Configure root account a bit
    install -dm 0750 "${pkgdir}/root/"
    install -dm 0700 "${pkgdir}/root/.ssh"
    install -Dm 0600 base.root-ssh "${pkgdir}/root/.ssh/config"
    #---Packages in gentoo base group
    depends+=('rsync' 'diffutils' 'wget' 'man-pages' 'device-mapper' 'less'
        'openssh' 'inetutils' 'busybox' 'kbd' )
    #---Packages in base-devel group
    depends+=( 'autoconf' 'automake' 'binutils' 'bison' 'fakeroot' 'flex' 'gcc'
        'groff' 'libtool' 'm4' 'make' 'patch' 'pkgconf' 'sudo' 'texinfo' 'which'
        'man-db' 'perl' 's-nail' 'texinfo' 'usbutils' 'flex' 'groff' 'libtool'
        'm4' 'pkgconf' )
    #---Expose shares using nfs
    install -dm 0755 "${pkgdir}/srv/nfs/sbp"

    #---ADMINISTRATION
    # Create reflector timers
    install -dm 0755 "${pkgdir}/usr/lib/systemd"
    install -dm 0755 "${pkgdir}/usr/lib/systemd/system"
    install -Dm 0644 admin.reflect-service \
        "${pkgdir}/usr/lib/systemd/system/reflector.service"
    install -Dm 0644 admin.reflect-timer \
        "${pkgdir}/usr/lib/systemd/system/reflector.timer"
    # Install tzupdate service
    install -Dm 0644 admin.tzupdate \
        "${pkgdir}/usr/lib/systemd/system/tzupdate.service"
    # Install aur management scripts
    install -dm 0755 "${pkgdir}/usr/bin"
    install -Dm 0755 admin.repo-remove  "${pkgdir}/usr/bin/archrepo-remove"
    install -Dm 0755 admin.repo-sync    "${pkgdir}/usr/bin/archrepo-sync"
    install -Dm 0755 admin.repo-build   "${pkgdir}/usr/bin/archrepo-build"
    # Put etckeeper override to select pacman
    install -dm 0755 "${pkgdir}/etc/etckeeper"
    install -Dm 0755 admin.etckeeper    "${pkgdir}/etc/etckeeper/local.conf"
    #---Sys-admin
    depends=(
        'dbus'
        'etckeeper'
        'fcron'
        'htop'
        'logrotate'
        'lsb-release'
        'mlocate'
        'neofetch'
        'rasdaemon'
        'supervisor'
        'tzupdate')         # Updates timezone
    #---Permissions
    depends+=(
        'pam'
        'polkit'
        'sudo')
    #---Packaging
    depends+=(
        'aurutils'
        'devtools'
        'reflector'
        'pacman-contrib' 'pacman-cleanup-hook'
        'archlinux-appstream-data'
        'archlinux-keyring')

    #---BOOT: UEFI

    #---SBP modules needed for base installation
    depends+=(
        'sbp-audio'         # For audio related stuff
        'sbp-boot'          # Booting (uefi or bios)
        'sbp-devices'       # General device communications
        'sbp-fs'            # File-type utilities
        'sbp-hardware'      # Generic hardware management
        'sbp-kernel'        # Kernel and kernel related utilities
        'sbp-network'       # Networking
        'sbp-utils'         # (Console) only applications
    )

}
