# Maintainer: Batuhan Baserdem <baserdem.batuhan@gmail.com>
# vim: ft=PKGBUILD
pkgname=sbp-base
pkgver=4.0
pkgrel=1
pkgdesc="SBP Meta Package: base system"
arch=('any')
url="https://github.com/bbaserdem/Arch"
licence=(MIT)
validpgpkeys=('0B7151C823559DD8A7A04CE36426139E2F4C6CCE')
source=(
    'base.etckeeper'
    'base.install'
    'base.reflect-service'
    'base.reflect-timer'
    'base.repo-build'
    'base.repo-remove'
    'base.repo-sync'
    'base.root-ssh' )

sha256sums=(SKIP SKIP SKIP SKIP SKIP SKIP SKIP)

package() {
    install=base.install
    provides=('vim')
    conflicts=('vim')
    depends=('base')
    # Install user scripts
    install -dm 0755 "${pkgdir}/usr"
    install -dm 0755 "${pkgdir}/usr/bin"
    install -Dm 0755 base.repo-remove   "${pkgdir}/usr/bin/archrepo-remove"
    install -Dm 0755 base.repo-sync     "${pkgdir}/usr/bin/archrepo-sync"
    install -Dm 0755 base.repo-build    "${pkgdir}/usr/bin/archrepo-build"
    # Configure root account a bit
    install -dm 0750 "${pkgdir}/root"
    install -dm 0700 "${pkgdir}/root/.ssh"
    install -Dm 0600 base.root-ssh      "${pkgdir}/root/.ssh/config"
    # Override vim 
    ln -sf /usr/bin/nvim "${pkgdir}/usr/bin/vim"
    # Put override to etckeeper config (as a local file)
    install -dm 0755 "${pkgdir}/etc"
    install -dm 0755 "${pkgdir}/etc/etckeeper"
    install -Dm 0755 base.etckeeper "${pkgdir}/etc/etckeeper/local.conf"

    #---SBP modules
    depends+=(
        'sbp-admin'
        'sbp-audio'
        'sbp-fs'
        'sbp-hardware'
        'sbp-kernel'
        'sbp-network'
        'sbp-utils')
    #---Packages in gentoo base group
    depends+=('rsync' 'diffutils' 'wget' 'man-pages' 'device-mapper' 'less'
        'openssh' 'inetutils' 'busybox' 'kbd' )
    #---Packages in base-devel group
    depends+=( 'autoconf' 'automake' 'binutils' 'bison' 'fakeroot' 'flex' 'gcc'
        'groff' 'libtool' 'm4' 'make' 'patch' 'pkgconf' 'sudo' 'texinfo' 'which'
        'man-db' 'perl' 's-nail' 'texinfo' 'usbutils' 'flex' 'groff' 'libtool'
        'm4' 'pkgconf' )
}
