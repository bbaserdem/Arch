# Maintainer: Batuhan Baserdem <baserdem.batuhan@gmail.com>
# vim: ft=PKGBUILD
pkgname=sbp-laptop
pkgver=4.0
pkgrel=1
pkgdesc="SBP Meta Package: Laptop setup"
arch=('any')
url="https://github.com/bbaserdem/Arch"
licence=(MIT)
validpgpkeys=('0B7151C823559DD8A7A04CE36426139E2F4C6CCE')
source=(
    'laptop.cmdline'
    'laptop.crypttab'
    'laptop.fstab'
    'laptop.hostname'
    'laptop.initrdtab'
    'laptop.install'
    'laptop.mkinitcpio'
    'laptop.refind'
    'laptop.sbupdate')
sha256sums=(SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP)
provides=('sbp-cmp')
conflicts=('sbp-homestation' 'sbp-server' 'sbp-workstation')
package() {
    install=laptop.install
    # Create local config files
    install -dm 0755 "${pkgdir}/etc"
    install -Dm 0644 laptop.crypttab   "${pkgdir}/etc/crypttab"
    install -Dm 0644 laptop.fstab      "${pkgdir}/etc/fstab"
    install -Dm 0644 laptop.hostname   "${pkgdir}/etc/hostname"
    install -Dm 0644 laptop.initrdtab  "${pkgdir}/etc/crypttab.initrd"
    install -Dm 0644 laptop.mkinitcpio "${pkgdir}/etc/mkinitcpio.conf"
    install -Dm 0644 laptop.sbupdate   "${pkgdir}/etc/sbupdate.local.conf"
    install -dm 0755 "${pkgdir}/etc/cmdline.d"
    install -Dm 0644 laptop.cmdline    "${pkgdir}/etc/cmdline.d/sbp.conf"
    # Create boot options
    install -dm 0755 "${pkgdir}/boot/efi/EFI/Arch"
    install -Dm 0755 laptop.refind \
        "${pkgdir}/boot/efi/EFI/Arch/refind_linux.conf"
    # Early initrd ucode
    depends=('intel-ucode')
    # Graphics
    depends+=(
        'intel-media-driver'
        'mesa' 'mesa-demos' 'lib32-mesa' 'lib32-mesa-demos'
        'vulkan-intel' 'lib32-vulkan-intel')
    # Power management
    depends+=('tlp')
    # System76 software
    depends+=(
        'firmware-manager'
        'system76-acpi-dkms'
        'system76-dkms'
        'system76-driver'
        'system76-firmware-daemon'
        'system76-io-dkms')
}
