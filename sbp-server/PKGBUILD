## Maintainer: Batuhan Baserdem <baserdem.batuhan@gmail.com>
# vim: ft=PKGBUILD
pkgname=sbp-server
pkgver=4.0
pkgrel=1
pkgdesc="SBP Meta Package: Server setup"
arch=('any')
url="https://github.com/bbaserdem/Arch"
licence=(MIT)
validpgpkeys=('0B7151C823559DD8A7A04CE36426139E2F4C6CCE')
source=(
    'server.cmdline'
    'server.crypttab'
    'server.fstab'
    'server.hostname'
    'server.initrdtab'
    'server.install'
    'server.mkinitcpio'
    'server.refind'
    'server.sbupdate')
sha256sums=(SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP SKIP)
provides=('sbp-cmp')
conflicts=('sbp-homestation' 'sbp-laptop' 'sbp-workstation')
package() {
    install=server.install
    # Create local config files
    install -dm 0755 "${pkgdir}/etc"
    install -Dm 0644 server.crypttab   "${pkgdir}/etc/crypttab"
    install -Dm 0644 server.fstab      "${pkgdir}/etc/fstab"
    install -Dm 0644 server.hostname   "${pkgdir}/etc/hostname"
    install -Dm 0644 server.initrdtab  "${pkgdir}/etc/crypttab.initrd"
    install -Dm 0644 server.mkinitcpio "${pkgdir}/etc/mkinitcpio.conf"
    install -Dm 0644 server.sbupdate   "${pkgdir}/etc/sbupdate.local.conf"
    install -dm 0755 "${pkgdir}/etc/cmdline.d"
    install -Dm 0644 server.cmdline    "${pkgdir}/etc/cmdline.d/sbp.conf"
    # Create boot options
    install -dm 0755 "${pkgdir}/boot/efi/EFI/Arch"
    install -Dm 0755 server.refind \
        "${pkgdir}/boot/efi/EFI/Arch/refind_linux.conf"
    # Early initrd ucode
    depends=('intel-ucode')
    # Graphics
    depends+=(
        'intel-media-driver'
        'mesa' 'mesa-demos'
        'vulkan-intel')
    depends=(
        'apache'            # Web server
        'kodi'              # Media file server
        'mariadb'           # Database management
        'radicale'          # CalDAV and CardDAV server
    )
}
